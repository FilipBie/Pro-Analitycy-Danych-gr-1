---
title: "Analiza opisowa"
author: "Wanesa"
date: "2025-01-22"
output: html_document
---
## WALIDACJA DANYCH 
```{r}
# Funkcja zamieniająca wszystkie puste wartości na NA
apartments_rent_pl_2024_06[apartments_rent_pl_2024_06 == ""] <- NA

# Wyświetlenie zaktualizowanego apartments_rent_pl_2024_06frame
print(apartments_rent_pl_2024_06)


library(openxlsx)
write.xlsx(apartments_rent_pl_2024_06, file = "NaszeDane.xlsx")

# Wczytanie danych
library(readxl)
```
Walidacja danych w analizie to proces sprawdzania poprawności, spójności i kompletności danych przed ich użyciem. Celem jest wykrycie i eliminacja błędów, takich jak duplikaty, brakujące wartości czy nieprawidłowe formaty.


WIZUALIZACJA DANCYCH

Odpowiednio przygotowane dane pozwolą na zilustowanie ich charakterystyk i rozkładów. Poniżej przedstawione zostały wybrane wizualizacje badanych danych

1.  Średnie wartości cen wynajmu w Polsce - mapa

```{r include=FALSE}
library(dplyr)
srednie_ceny <- Imputed_Data_Combined %>%
  group_by(city) %>%
  summarise(srednie_ceny = mean(price))
print(srednie_ceny)

install.packages(c("maps", "mapdata", "ggplot2"))

library(maps)
library(mapdata)
library(ggplot2)
```

```{r echo=FALSE}
poland_map <- map_data("worldHires", region = "Poland")


# dane
cities <- data.frame(
  city = c("Białystok", "Bydgoszcz", "Częstochowa", "Gdańsk", "Gdynia", "Katowice", "Kraków", "Łódź", "Lublin", "Poznań", "Radom", "Rzeszów", "Szczecin", "Warszawa", "Wrocław"),
  lon = c(23.1667, 18.0000, 19.1167, 18.6333, 18.5333, 19.0000, 19.9500, 19.4667, 
          22.5667, 16.9167, 21.1667, 22.0167, 14.5667, 21.0333, 17.0333),
  lat  = c(53.1333, 53.1167, 50.8000, 54.3667, 54.5333, 50.2500, 50.0500, 51.7833, 
          51.2333, 52.4167, 51.4000, 50.0500, 53.4333, 52.2000, 51.1167),
  price = c(1928, 1987, 1915, 3213, 3317, 2411, 3317, 2110, 2570, 2593, 1851, 2521, 2627, 5090, 3172) 
)

# mapa 
ggplot() +
  geom_polygon(data = poland_map, aes(x = long, y = lat, group = group), fill = "lightgray", color = "black") +
  geom_point(data = cities, aes(x = lon, y = lat, size = price), alpha = 0.7, color = "darkmagenta") +  
  scale_size_continuous(range = c(3, 10)) +  
  geom_text(data = cities, aes(x = lon, y = lat, label = city), vjust = -1, size = 3, color = "black") +  
  labs(title = "Średnie ceny wynajmu w Polsce", size = "Cena [PLN]") +
  theme_minimal()
```

2.Rozkłady

a)  rozkład liczby pokoi

```{r}
 ggplot(Imputed_Data_Combined, aes(x = rooms)) +
    geom_histogram(binwidth = 1, fill = "violetred3", color = "black", alpha = 0.7) +
    labs(title = "Rozkład liczby pokoi",
         x = "Liczba pokoi", y = "Liczba mieszkań") +
    theme_minimal()
```

b)liczba mieszkań z windą i bez windy w różnych miastach

```{r}
liczba_mieszkan_z_winda <- Imputed_Data_Combined %>%
    group_by(city, hasElevator) %>%
    summarise(count = n())
  
  ggplot(liczba_mieszkan_z_winda, aes(x = reorder(city, count), y = count, fill = hasElevator)) +
    geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +  
    labs(title = "Liczba mieszkań z windą i bez windy w różnych miastach",
         x = "Miasto", y = "Liczba mieszkań") +
    scale_fill_manual(values = c("thistle", "deeppink4")) +  
    coord_flip() + 
    theme_minimal() +
    theme(
      legend.position = "top",  
      axis.text.x = element_text(angle = 45, hjust = 1),
      plot.title = element_text(size = 14, hjust = 0.5)
    )

```

c)  Liczba mieszkań w poszczególnych miastach

```{r}
 liczba_mieszkan <- Imputed_Data_Combined %>%
    group_by(city) %>%
    summarise(count = n())
  
  
  ggplot(liczba_mieszkan, aes(x = reorder(city, count), y = count, fill = city)) +
    geom_bar(stat = "identity", fill = "mediumorchid4", alpha = 0.7) +
    geom_text(aes(label = count),  
              vjust = -0.3, size = 3.5) +
    labs(title = "Liczba mieszkań w poszczególnych miastach",
         x = "Miasta", y = "Liczba mieszkań") +
    coord_flip() +  
    theme_minimal() +
    theme(
      legend.position = "none",
      axis.text.x = element_text(angle = 45, hjust = 1),
      axis.title = element_text(size = 12),
      plot.title = element_text(size = 14, hjust = 0.5)
    )
  
```

3.  ANALIZA DOSTĘPNOŚCI INFRASTRUKTÓRY

a)Cena wynajmu vs. Odległość od centrum

```{r}
ggplot(Imputed_Data_Combined, aes(x = centreDistance, y = price)) +
    geom_point(alpha = 0.5, color = "orchid4") +  # Punkty na wykresie
    geom_smooth(method = "lm", color = "black", se = TRUE, fill = "gray70") +  # Linia regresji z przedziałem ufności
    labs(title = "Cena wynajmu vs. Odległość od centrum",
         x = "Odległość od centrum [km]",
         y = "Cena wynajmu [PLN]") +
    theme_minimal()
```

Wpływ odległości do szkół na cenę mieszkań

```{r}
ggplot(Imputed_Data_Combined, aes(x = schoolDistance, y = price)) +
    geom_point(alpha = 0.5, color = "orchid4") +  # Punkty na wykresie
    geom_smooth(method = "lm", color = "black", se = TRUE, fill = "gray70") +  # Linia regresji z przedziałem ufności
    labs(title = "Odległość do szkoły vs. Cena wynajmu",
         x = "Odległość do szkoły [km]",
         y = "Cena wynajmu [PLN]") +
    theme_minimal()
```

------------------------------------------------------------------------

ANALIZA OPISOWA

Poniższe dane zawierają analizę opisową dla badanej bazy danych

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
# pakiety:
library(dplyr)
library(ggplot2)
library(summarytools)
library(corrplot)
```

Tabela 1. Podstawowe statystyki opisowe dla kluczowych zmiennych

```{r Podstawowe statystyki opisowe dla kluczowych zmiennych, include=FALSE}
key_vars <- c("price", "squareMeters", "rooms", "centreDistance", 
              "schoolDistance", "clinicDistance", "buildYear")
stats <- Imputed_Data_Combined %>%
  select(all_of(key_vars)) %>%
  summarise_all(list(
    Min = ~ min(., na.rm = TRUE),
    Max = ~ max(., na.rm = TRUE),
    Mean = ~ round(mean(., na.rm = TRUE), 2),
    Median = ~ round(median(., na.rm = TRUE), 2),
    SD = ~ round(sd(., na.rm = TRUE), 2),
    Q1 = ~ quantile(., 0.25, na.rm = TRUE),
    Q3 = ~ quantile(., 0.75, na.rm = TRUE)
  ))

```

```{r echo=FALSE}

# Wyświetl wyniki
print(stats)

view(dfSummary(Imputed_Data_Combined %>% select(all_of(key_vars))))
```

2.  Szacowanie korelacji dla wybranych danych ilościowych (cena, ilość pokoi, piętro, dystans od centrum, ilość pięter, rok budowy)

```{r Szacowanie korelacji dla wybranych danych ilościowych, echo=FALSE}
numeric_vars <- Imputed_Data_Combined %>%
  select("price","rooms","floor","centreDistance","floorCount","buildYear") %>%
  na.omit()

cor_matrix <- cor(numeric_vars)
cor_matrix
```

3.  Macierzy oszacowanych korelacji

```{r Macierzy oszacowanych korelacji, echo=FALSE}
corrplot(cor_matrix, method = "color", type = "upper", order = "hclust",
         tl.col = "black", tl.srt = 45, addCoef.col = "black")
```
